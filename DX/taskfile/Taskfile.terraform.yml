version: '3'

vars:
  TF_VARS_FILE:
  TF_BACKEND_CONFIG:
  TF_WORKING_DIR:

tasks:
  init:
    desc: "Run Terraform init"
    cmds:
      - terraform init -backend=false {{ .CLI_ARGS }}

  init-stateful:
    desc: "Run Terraform init"
    cmds:
      - terraform init -backend-config={{.TF_BACKEND_CONFIG}} {{ .CLI_ARGS }}

  plan-vars:
    desc: "Run Terraform plan"
    cmds:
      - terraform plan -var-file={{.TF_VARS_FILE}} {{ .CLI_ARGS }}

  plan:
    desc: "Run Terraform plan"
    cmds:
      - terraform plan {{ .CLI_ARGS }}

  fmt:
    desc: "Run Terraform fmt check"
    cmds:
      - terraform fmt -recursive -write=false {{ .CLI_ARGS }}

  fmt-fix:
    desc: "Run Terraform fmt fixing the unformatted files"
    cmds:
      - terraform fmt -recursive -write=true {{ .CLI_ARGS }}

  lint:
    desc: "Run Terraform lint"
    cmds:
      - tflint --init
      - tflint --error-with-issues {{ .CLI_ARGS }}
